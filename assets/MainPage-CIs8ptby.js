import{U as F,a as y,b as P,L as $}from"./UiPagination-0lcWgvxJ.js";import{_ as d,c as h,a as i,o as n,b as l,d as k,e as u,n as D,F as b,r as o}from"./index-CLnnKecG.js";import{U as V}from"./UiButton-E_cY_5DE.js";const U={emits:["update:modelValue"],props:{modelValue:{type:String,required:!0,default:""}}},w={class:"search-container"};function M(t,e,s,g,a,r){return n(),h("div",w,[i("input",{type:"text",id:"search",name:"search",class:"search-input filter-settings",placeholder:"Поиск",onInput:e[0]||(e[0]=c=>t.$emit("update:modelValue",c.target.value))},null,32)])}const S=d(U,[["render",M],["__scopeId","data-v-baf98614"]]),B={components:{ListMovies:$,UiSearch:S,UiFilter:P,UiSorting:y,UiButton:V,UiPagination:F},data(){return{urlBase:"https://api.themoviedb.org/3",movies:[],genres:[],searchValue:"",domenFilter:"",genresFilter:"",ratingFilter:[],fromDateFilter:"",toDateFilter:"",typeSort:"popularity.desc",loaded:!1,countPages:1,totalPages:null}},methods:{async getDataMovies(){this.loaded=!1;const e=await fetch(`${this.urlBase}/movie/popular?api_key=899ff14e8c54a1207e2a3795988ebb78&language=ru-RU&page=${this.countPages}`);if(e.ok){const s=await e.json();this.totalPages=Number(s.total_pages),this.movies=s.results}else console.log("kdjfghd");this.genres.length>0&&(this.loaded=!0)},async getDataGenres(){const e=await fetch(`${this.urlBase}/genre/movie/list?api_key=899ff14e8c54a1207e2a3795988ebb78&language=ru-RU`);if(e.ok){const s=await e.json();this.genres=s.genres}else console.log("kdjfghd");this.movies.length>0&&(this.loaded=!0)},async getFilterMovies(){this.loaded=!1,this.domenFilter="",this.genresFilter.length>0&&(this.domenFilter+=`&with_genres=${this.genresFilter}`),this.ratingFilter.length>0&&(this.domenFilter+=`&vote_average.gte=${this.ratingFilter[0]}&vote_average.lte=${this.ratingFilter[1]}`),this.fromDateFilter.length>0&&(this.domenFilter+=`&primary_release_date.gte=${this.fromDateFilter}`),this.toDateFilter.length>0&&(this.domenFilter+=`&primary_release_date.lte=${this.toDateFilter}`),this.typeSort.length>0&&(this.domenFilter+=`&sort_by=${this.typeSort}`),this.typeSort==="vote_average.desc"&&(this.domenFilter+="&vote_count.gte=1000");const e=await fetch(`${this.urlBase}/discover/movie?api_key=899ff14e8c54a1207e2a3795988ebb78${this.domenFilter}&language=ru-RU&page=${this.countPages}`);if(e.ok){const s=await e.json();this.totalPages=Number(s.total_pages),this.movies=s.results}else console.log("kdjfghd");this.loaded=!0},getDataFilter(t,e,s,g){this.searchValue="",this.genresFilter=t.join(","),this.ratingFilter=e,this.fromDateFilter=s,this.toDateFilter=g,this.countPages=1,this.getFilterMovies()},getDataSort(t){this.countPages=1,this.searchValue="",this.typeSort=t,this.getFilterMovies()},async searchMovie(){this.loaded=!1;const t="899ff14e8c54a1207e2a3795988ebb78";let e="";if(this.searchValue.length>0?e=await fetch(`${this.urlBase}/search/movie?api_key=${t}&query=${this.searchValue}&language=ru-RU&page=${this.countPages}`):e=await fetch(`${this.urlBase}/movie/popular?api_key=${t}&language=ru-RU&page=1`),e.ok){const s=await e.json();this.totalPages=Number(s.total_pages),this.movies=s.results}else console.log("kdjfghd");this.loaded=!0},openNewPage(t){this.countPages=t,this.searchValue.length>0?this.searchMovie():this.domenFilter.length>0?this.getFilterMovies():this.getDataMovies()}},watch:{searchValue(){this.countPages=1,this.searchMovie()}},mounted(){this.getDataMovies(),this.getDataGenres()}},j={class:"filters-container"},N={class:"search-button-container"},K={key:1,class:"not-found-block"},C={key:2,class:"load-animation-container"};function R(t,e,s,g,a,r){const c=o("ui-search"),p=o("ui-filter"),m=o("ui-sorting"),f=o("list-movies"),_=o("ui-pagination");return n(),h(b,null,[i("div",j,[i("div",N,[l(c,{modelValue:a.searchValue,"onUpdate:modelValue":e[0]||(e[0]=v=>a.searchValue=v)},null,8,["modelValue"])]),l(p,{genres:a.genres,onFilterData:r.getDataFilter},null,8,["genres","onFilterData"]),l(m,{onSortData:r.getDataSort},null,8,["onSortData"])]),this.loaded&&this.movies.length>0?(n(),k(f,{key:0,movies:a.movies,genres:a.genres},null,8,["movies","genres"])):u("",!0),a.loaded&&this.movies.length===0?(n(),h("div",K,[...e[1]||(e[1]=[i("p",null,"По вашему запросу ничего не найдено",-1)])])):u("",!0),this.loaded?u("",!0):(n(),h("div",C,[...e[2]||(e[2]=[i("i",{class:"fa-solid fa-circle-notch fa-spin"},null,-1)])])),i("div",{class:D(["pagination-hidden-container",this.loaded&&this.totalPages>1?"":"hidden-block"])},[l(_,{countPages:a.countPages,onUpdateCountPage:r.openNewPage,totalPages:a.totalPages},null,8,["countPages","onUpdateCountPage","totalPages"])],2)],64)}const G=d(B,[["render",R],["__scopeId","data-v-a34cb005"]]);export{G as default};
